# transfer-family-experiment

An AWS Transfer Family hello world. An SFTP facade to an S3 bucket.

## How to deploy and undeploy

* `./tool.sh generate-key` to generate an SSH key for the SFTP user(s). 
* `./tool.sh deploy-basic` to deploy the server with service-managed authentication.
* `./tool.sh deploy-custom-auth` to deploy the server with custom authentication.
* `./tool.sh sftp-key <username>` to connect the server using `sftp` as user `<username>` with SSH key generated by `./tool.sh generate-key`.
* `./tool.sh sftp-password <username>` to connect the server using `sftp` as user `<username>` with password (`sftp` will ask you to enter the password).
* `./tool.sh undeploy` to undeploy.

## Service-managed authentication

In this experiment there's only one user `dummyuser` and the only authentication option is SSH key. See `template-basic.yml` for details.

* Deploy using `./tool.sh deploy-basic`.
* `./tool.sh sftp-key dummyuser` to connect to the server.
* `pwd` will report `/`.
* `ls` will report no contents.
* `put README.md 1.md` to upload local `README.md` to the server as `1.md`.
* Go to S3 bucket and see that there's a `dummyuser` directory, and there's a `1.md` in that directory.
* Upload `README.md` to S3 bucket's `dummyuser` directory.
* In `sftp` do `ls` and see that `README.md` is there now.
* `get README.md 2.md` to download `README.md` as `2.md`

## Custom authentication

In this experiment server delegates all authentication decisions to AWS API Gateway. There are 2 users: `user1` (password: `qwerty`) and `user2` (password: `asdfgh`). Both also support the SSH key. See `template-custom-auth.yml` for details.

* Deploy using `./tool.sh deploy-custom-auth`.
* `./tool.sh sftp-key user1` to connect and authenticate using SSH key.
* `./tool.sh sftp-password user1` to connect and authenticate using SSH key.
* `./tool.sh sftp-key user2` to connect and authenticate using SSH key.
* `./tool.sh sftp-password user2` to connect and authenticate using SSH key.
* Try `pwd`, `ls`, `put`, `get` as suggested in "Service-managed authentication" example. 2 users are totally isolated from each other, each has its own directory in S3 bucket.
