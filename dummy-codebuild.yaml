AWSTemplateFormatVersion: '2010-09-09'

Parameters:
  DummyCodeBuildProjectName:
    Type: String
    Default: DummyCodeBuildProject

Resources:
  DummyCodeBuildProjectRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: DummyCodeBuildProjectRole
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
          Effect: Allow
          Principal:
            Service: lambda.amazonaws.com
          Action: sts:AssumeRole
      Path: /
      Policies:
        - PolicyName: WriteLogs
          PolicyDocument:
            Version: 2012-10-17
            Statement:
              - Effect: Allow
                Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                  - logs:DescribeLogStreams
                Resource:
                  - !Sub "arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group/aws/codebuild/${DummyCodeBuildProjectName}"
                  - !Sub "arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group/aws/codebuild/${DummyCodeBuildProjectName}:*"

  DummyCodeBuildProject:
    Type: AWS::CodeBuild::Project
    Properties:
      Name: !Ref DummyCodeBuildProjectName
      Description: My dummy CodeBuild project
      ServiceRole: !GetAtt DummyCodeBuildProjectRole.Arn
      Artifacts:
        Type: NO_ARTIFACTS
      Environment:
        ComputeType: BUILD_GENERAL1_SMALL
        EnvironmentVariables:
          - Name: SOME_ENV_VARIABLE1
            Value: some env variable 1 value
        Image: aws/codebuild/java:openjdk-8
        Type: LINUX_CONTAINER
      Source:
        Type: GITHUB
        Location: https://github.com/loki2302/aws-ci-experiment.git
        BuildSpec: buildspec1.yml
      TimeoutInMinutes: 5
